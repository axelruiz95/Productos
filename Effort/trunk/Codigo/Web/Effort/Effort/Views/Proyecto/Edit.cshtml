@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Main.cshtml";
}

@model Effort.Models.Proyecto
<div class="container">

    <div class="container">
        <h2>Editar Proyecto</h2>
        <h4 style="color: red;">@ViewBag.Error</h4>
    </div>
    <form role="form" method="post" action="@Url.Action("Edit", "Proyecto")">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="usr">Identificador del proyecto:</label>
                        <input type="hidden" id="idProyecto" name="idProyecto" value="@Model.idProyecto" />
                        <input type="text" class="form-control" id="id" name="id" value="@Model.idProyecto" disabled>
                        @Html.ValidationMessageFor(model => model.idProyecto)
                    </div>
                </div>

                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="usr">Nombre del proyecto:</label>
                        <input type="text" class="form-control" id="nombre" name="nombre" value="@Model.nombre">
                        @Html.ValidationMessageFor(model => model.nombre)
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="usr">Fecha:</label>
                        <input  type="text" class="form-control" id="fechaInicio" name="fechaInicio" value="@Model.fechaInicio.ToString("dd/MM/yyyy")">
                        @Html.ValidationMessageFor(model => model.fechaInicio)
                    </div>
                </div>

                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="usr">Duracion en días:</label>
                        <input type="text" class="form-control" id="duracion" name="duracion" value="@Model.duracion" onkeypress="return soloNumeros(event);">
                        @Html.ValidationMessageFor(model => model.duracion)
                    </div>
                </div>
            </div>
        </div>


        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="usr">Presupuesto en horas:</label>
                        <input type="text" class="form-control" id="presupuesto_hrs" name="presupuesto_hrs" value="@Model.presupuesto_hrs" onkeypress="return soloNumeros(event);">
                        @Html.ValidationMessageFor(model => model.presupuesto_hrs)
                    </div>
                </div>

                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="usr">Presupuesto(USD):</label>
                        <div class="input-group">
                            <span class="input-group-addon">$</span>
                            <input type="text" class="form-control" aria-label="Amount (to the nearest dollar)" id="presupuesto_precio" 
                             onkeypress="return SoloNumerosDecimales(event, '0.0', 4, 0);"  name="presupuesto_precio" value="@Model.presupuesto_precio">
                            @Html.ValidationMessageFor(model => model.presupuesto_precio)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="sel1">Administrador:</label>
                        @Html.DropDownList("administrador_proyecto",
                        null,
                        new { @class = "form-control" })
                    </div>
                </div>

                <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                        <label for="sel1">Estado del proyecto:</label>
                        @Html.DropDownList("EstadoProyecto",
                        null,
                        new { @class = "form-control" })
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <button class="btn btn-primary" type="submit" class="btn btn-default">Actualizar</button>
            <a class="btn btn-danger" data-toggle="modal" data-target="#eliminar">Eliminar</a>

            <!-- Modal -->
            <div class="modal fade" id="eliminar" role="dialog">
                <div class="modal-dialog modal-sm">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Eliminar</h4>
                        </div>
                        <div class="modal-body">
                            <p>Seguro que deseas eliminar el registro?</p>
                        </div>
                        <div class="modal-footer">
                            <a href="~/Proyecto/Delete?id=@Model.idProyecto" class="btn btn-default">Aceptar</a>
                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>

    <div id="chart_div"></div>

</div>

<script type="text/javascript">
    // When the document is ready
    $(document).ready(function () {

        $('#fechaInicio').datepicker({
            format: "dd/mm/yyyy",
            autoclose: true,
            clearBtn: true,
            language: "es"

        });

        $("#perfil").val('@Model.administrador_proyecto');
                $("#estado").val('@Model.EstadoProyecto');

    });

    var jsonData = $.ajax({
        url: "./Esfuerzo/esfuerzosPorEquipo?id=@Model.idProyecto",
        dataType: "json",
        async: false
    }).responseJSON;

    google.load('visualization', '1', { 'packages': ['corechart'] });
    google.setOnLoadCallback(drawChart);

    function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn("string", "Equipo");
        data.addColumn("number", "Esfuerzos");


        $.each(jsonData, function (i, item) {
            data.addRow([item.nombreEquipo, item.esfuerzo]);

        });

        var options = {
            title: 'Esfuerzos del proyecto',
            height: 400
        };

        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));

        chart.draw(data, options);
    }
</script>
