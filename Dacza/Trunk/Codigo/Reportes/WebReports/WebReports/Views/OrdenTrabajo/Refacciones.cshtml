@model IEnumerable<WebReports.Models.ViewModels.ViewRefacciones>

@{
    ViewBag.Title = "Refacciones";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<hgroup class="title">
    <h1 class="text-center">@ViewBag.Title</h1>    
</hgroup>
<p />

 <div class="container">
    
        @{
            WebReports.Models.FilterModels.FilterRefacciones filtro = (WebReports.Models.FilterModels.FilterRefacciones)Session["Filtro"]; 
            String sFiltro= "";
            int nCont = 0;
            if(!filtro.Sucursal.IsEmpty())
            {
                String sucursal = Session["Sucursal"].ToString();
                nCont++;
                <div class="container-left-filter">
                    <h2>Sucursal: @sucursal</h2>
                </div>
            } 
            if(filtro.FechaIni != null && filtro.FechaFin != null)
            {
                if (nCont > 0){
                    <div class="container-right-filter">
                        <h2>Fecha: @filtro.FechaIni.Value.Date.ToShortDateString() al @filtro.FechaFin.Value.Date.ToShortDateString()</h2>
                    </div>
                }
                else{
                    <div class="container-left-filter">
                        <h2>Fecha: @filtro.FechaIni.Value.Date.ToShortDateString() al @filtro.FechaFin.Value.Date.ToShortDateString()</h2>
                    </div>
                }
                nCont++;
            } 
            else if(filtro.FechaIni != null)
            {
                if (nCont > 0){
                    <div class="container-right-filter">
                        <h2>Fecha: @filtro.FechaIni.Value.Date.ToShortDateString() al @DateTime.Today.Date.ToShortDateString()</h2>
                    </div>
                }
                else{
                    <div class="container-left-filter">
                        <h2>Fecha: @filtro.FechaIni.Value.Date.ToShortDateString() al @DateTime.Today.Date.ToShortDateString()</h2>
                    </div>
                }
                nCont++;
            }
            else if(filtro.FechaFin != null)
            {
                if (nCont > 0){
                    <div class="container-right-filter">
                        <h2>Fecha: al @filtro.FechaFin.Value.Date.ToShortDateString()</h2>
                    </div>
                }
                else{
                    <div class="container-left-filter">
                        <h2>Fecha: al @filtro.FechaFin.Value.Date.ToShortDateString()</h2>
                    </div>
                }
                nCont++;
            }
            
            if(!filtro.Taller.IsEmpty() && !filtro.Taller.Equals("-999"))
            {
                String taller = Session["Taller"].ToString();
                if ((nCont % 2) == 0)
                {
                    <div class="container-left-filter">
                        <h2>Taller: @taller</h2>
                    </div>
                }
                else if (nCont > 0)
                {
                    <div class="container-right-filter">
                        <h2>Taller: @taller</h2>
                    </div>
                }
                nCont++;
            } 
            if(!filtro.Vin.IsEmpty())
            {
                if ((nCont % 2) == 0)
                {
                    <div class="container-left-filter">
                        <h2>Vin: @filtro.Vin</h2>
                    </div>
                }
                else if (nCont > 0)
                {
                    <div class="container-right-filter">
                        <h2>Vin: @filtro.Vin</h2>
                    </div>
                }
                nCont++;
            }
            if(!filtro.Parte.IsEmpty())
            {
                if ((nCont % 2) == 0)
                {
                    <div class="container-left-filter">
                        <h2>Parte: @filtro.Parte</h2>
                    </div>
                }
                else if (nCont > 0)
                {
                    <div class="container-right-filter">
                        <h2>Parte: @filtro.Parte</h2>
                    </div>
                }
            } 
        }     
</div>

<p></p>

 <div class="panel-group">
    @{        
        List<WebReports.Models.ViewModels.ViewRefacciones> talleres = Model.GroupBy(x => x.Taller.TallerId).Select(g => g.First()).OrderBy(x => x.Taller.Clave).ToList();        
        
        foreach (var item in talleres) {
           
                @Html.Raw("<div class=\"panel panel-default\">")
                @Html.Raw("<div class=\"panel-heading panel-heading-top\">")
                @Html.Raw("<h4 class=\"panel-title\">")
                @Html.Raw("<a data-toggle=\"collapse\" href=#" + @item.Taller.TallerId + ">" + @item.Taller.Descripcion + "</a>")
                @Html.Raw("</h4>")
                @Html.Raw("</div>")
                @Html.Raw("<div id=" + @item.Taller.TallerId + " class=\"panel-collapse collapse\">")
                @Html.Partial("Refaccion", Model.ToList().FindAll(x => x.Taller.TallerId == item.Taller.TallerId).OrderBy(x => x.Folio).ThenBy(x => x.ClaveArticulo).ToList())
                @Html.Raw("</div>")
                @Html.Raw("</div>")
            
         }//foreach (var item in Model)       
                 
     }   
 </div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="../Scripts/bootstrap.min.js" type="text/javascript"></script>

}     
     
         
