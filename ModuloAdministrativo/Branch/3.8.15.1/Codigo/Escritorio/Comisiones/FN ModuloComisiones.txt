if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[FN_ComisionesTipoRutaXCedis]') and xtype in (N'FN', N'IF', N'TF'))
drop function [dbo].[FN_ComisionesTipoRutaXCedis]
GO

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[FN_ComisionesTipoRutaYFamilia]') and xtype in (N'FN', N'IF', N'TF'))
drop function [dbo].[FN_ComisionesTipoRutaYFamilia]
GO

SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS OFF 
GO

CREATE FUNCTION dbo.FN_ComisionesTipoRutaXCedis
(
	@IdCedis as bigint
)  
RETURNS Table 

AS  

	Return
	(
	SELECT     @IdCedis as IdCedis, IdTipoRuta, TipoRuta, FechaAlta
	FROM         TipoRuta
	WHERE     (IdTipoRuta IN
	                          (SELECT     TipoRuta
	                            FROM          rutas
	                            WHERE      (idcedis = @IdCedis) AND (Status = 'A'))) AND (Status = 'A')

	)




GO
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS OFF 
GO

CREATE FUNCTION dbo.FN_ComisionesTipoRutaYFamilia
(
	@IdCedis as bigint
)  
RETURNS Table 

AS  

	Return
	(
	SELECT     FNCOMRUT.IdCedis, FNCOMRUT.IdTipoRuta, FNCOMRUT.TipoRuta, FAM.IdFamilia, FAM.Familia
	FROM         FN_ComisionesTipoRutaXCedis(@IdCedis) FNCOMRUT CROSS JOIN
	                      Familias FAM
	Where FAM.Status = 'A'
	GROUP BY FNCOMRUT.IdCedis, FNCOMRUT.IdTipoRuta, FNCOMRUT.TipoRuta, FAM.IdFamilia, FAM.Familia

	)


GO
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

